<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Galeri Foto Kampung Pameutingan</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f4f6f8;
      color: #333;
    }
    header {
      background: #00695c;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    nav {
      background: #004d40;
      padding: 0.5rem;
      text-align: center;
    }
    nav a {
      color: white;
      margin: 0 10px;
      text-decoration: none;
      font-weight: bold;
    }
    .filter-buttons {
      text-align: center;
      margin: 1rem 0;
    }
    .filter-buttons button {
      background: #00897b;
      border: none;
      color: white;
      padding: 0.5rem 1rem;
      margin: 0.3rem;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .filter-buttons button:hover,
    .filter-buttons button.active {
      background: #004d40;
    }
    .upload-area {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .upload-area input,
    .upload-area select,
    .upload-area button {
      margin: 0.5rem 0;
      padding: 0.5rem;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .upload-area button {
      background: #00796b;
      color: white;
      font-weight: bold;
      border: none;
      transition: background 0.3s;
    }
    .upload-area button:hover {
      background: #004d40;
    }
    #preview img {
      max-width: 100px;
      margin: 5px;
      border-radius: 5px;
    }
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 10px;
      padding: 1rem;
    }
    .photo {
      position: relative;
      cursor: pointer;
      overflow: hidden;
      border-radius: 10px;
      transition: transform 0.3s ease;
    }
    .photo img {
      width: 100%;
      border-radius: 10px;
      display: block;
      transition: transform 0.3s ease;
    }
    .photo:hover img {
      transform: scale(1.1);
    }
    .delete-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 3px 6px;
      border-radius: 3px;
      font-size: 14px;
      display: none;
      cursor: pointer;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease-in-out;
    }
    .modal-content {
      max-width: 90%;
      max-height: 90%;
      border-radius: 10px;
      animation: zoomIn 0.3s ease;
    }
    .close {
      position: absolute;
      top: 20px;
      right: 30px;
      color: white;
      font-size: 30px;
      font-weight: bold;
      cursor: pointer;
    }
    @keyframes zoomIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    footer {
      text-align: center;
      background: #00695c;
      color: white;
      padding: 1rem;
      margin-top: 2rem;
    }

    #loader {
      display: none;
      text-align: center;
      margin-top: 10px;
    }

    .spinner {
      border: 4px solid #ccc;
      border-top: 4px solid #00897b;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 600px) {
      .upload-area {
        margin: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Galeri Foto Kampung Pameutingan</h1>
    <p>Upload & hapus foto hanya untuk admin (dengan sandi)</p>
  </header>

  <nav>
    <a href="index.html">Beranda</a>
  </nav>

  <div class="filter-buttons">
    <button data-filter="all" class="active">Semua</button>
    <button data-filter="17-Agustus">17-Agustus</button>
    <button data-filter="Voli">Voli</button>
    <button data-filter="Kegiatan Masyarakat">Kegiatan Masyarakat</button>
  </div>

  <section class="upload-area">
    <h2>Tambah Foto (Akses Terbatas)</h2>
    <input type="password" id="passwordInput" placeholder="Masukkan sandi upload">
    <button id="verifyBtn">Verifikasi</button>
    <select id="kategoriSelect" disabled>
      <option value="">Pilih Kategori</option>
      <option value="17-Agustus">17-Agustus</option>
      <option value="Voli">Voli</option>
      <option value="Kegiatan Masyarakat">Kegiatan Masyarakat</option>
    </select>
    <input type="file" id="uploadInput" accept="image/*" multiple disabled>
    <div id="loader"><div class="spinner"></div></div>
    <div id="preview"></div>
  </section>

  <main class="gallery"></main>

  <div id="modal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="modal-img" />
  </div>

  <footer>
    <p>&copy; 2025 Kampung Pameutingan</p>
  </footer>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDQ-7xsGhjQ1fxMhFCZQctVpGsobN2Q7zs",
      authDomain: "galleri-ku.firebaseapp.com",
      projectId: "galleri-ku",
      storageBucket: "galleri-ku.firebasestorage.app",
      messagingSenderId: "312570653219",
      appId: "1:312570653219:web:63bd9aa84a78bb8b991f96",
      measurementId: "G-XK1GDGF2DX"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const clientID = "8f40688e94e46fc";
    const gallery = document.querySelector(".gallery");
    const kategoriSel = document.getElementById("kategoriSelect");
    const uploadInput = document.getElementById("uploadInput");
    const preview = document.getElementById("preview");
    const passwordInp = document.getElementById("passwordInput");
    const verifyBtn = document.getElementById("verifyBtn");
    const loader = document.getElementById("loader");
    let adminMode = false;

    const modal = document.getElementById("modal");
    const modalImg = document.getElementById("modal-img");
    document.querySelector(".close").onclick = () => modal.style.display = "none";
    function bindZoom(img) {
      img.addEventListener("click", () => {
        modal.style.display = "flex";
        modalImg.src = img.src;
      });
    }

    function tambahKeGaleri(id, url, kategori, showDelete = false) {
      const div = document.createElement("div");
      div.className = `photo ${kategori}`;
      div.dataset.id = id;

      const del = document.createElement("span");
      del.className = "delete-btn";
      del.textContent = "❌";
      if (showDelete) del.style.display = "block";

      del.addEventListener("click", async (e) => {
        e.stopPropagation();
        if (confirm("Hapus foto ini?")) {
          await db.collection("foto").doc(id).delete();
          div.remove();
        }
      });

      const img = document.createElement("img");
      img.src = url;
      bindZoom(img);

      div.appendChild(img);
      div.appendChild(del);
      gallery.appendChild(div);
    }

    verifyBtn.addEventListener("click", () => {
      if (passwordInp.value === "1112") {
        alert("Sandi benar. Mode admin aktif.");
        adminMode = true;
        uploadInput.disabled = false;
        kategoriSel.disabled = false;
        document.querySelectorAll(".delete-btn").forEach(btn => btn.style.display = "block");
      } else {
        alert("Sandi salah.");
      }
    });

    async function uploadKeImgur(file) {
      const formData = new FormData();
      formData.append("image", file);
      const res = await fetch("https://api.imgur.com/3/image", {
        method: "POST",
        headers: { Authorization: "Client-ID " + clientID },
        body: formData
      });
      const data = await res.json();
      return data.success ? data.data.link : null;
    }

    uploadInput.addEventListener("change", async () => {
      const kategori = kategoriSel.value;
      if (!kategori) return alert("Pilih kategori dulu.");
      const files = Array.from(uploadInput.files);

      loader.style.display = "block";
      preview.innerHTML = "";

      for (const file of files) {
        const thumb = document.createElement("img");
        thumb.src = URL.createObjectURL(file);
        preview.appendChild(thumb);

        const url = await uploadKeImgur(file);
        if (url) {
          const docRef = await db.collection("foto").add({ url, kategori, waktu: Date.now() });
          tambahKeGaleri(docRef.id, url, kategori, true);
        } else {
          alert("Gagal upload ke Imgur.");
        }
      }

      loader.style.display = "none";
      uploadInput.value = "";
    });

    document.querySelectorAll(".filter-buttons button").forEach(btn => {
      btn.addEventListener("click", () => {
        const filter = btn.dataset.filter;
        document.querySelectorAll(".filter-buttons button").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        document.querySelectorAll(".photo").forEach(photo => {
          photo.style.display = (filter === "all" || photo.classList.contains(filter)) ? "block" : "none";
        });
      });
    });

    async function loadFoto() {
      const snapshot = await db.collection("foto").orderBy("waktu", "desc").get();
      snapshot.forEach(doc => {
        const data = doc.data();
        tambahKeGaleri(doc.id, data.url, data.kategori, adminMode);
      });
    }

    loadFoto();
  </script>
</body>
</html>
